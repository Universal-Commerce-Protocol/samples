<!--
   Copyright 2026 UCP Authors

   Licensed under the Apache License, Version 2.0 (the "License");
   you may not use this file except in compliance with the License.
   You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.

Note:
   This file is automatically generated by running simple_happy_path_client.py.
   Do not modify manually.
-->
# UCP Happy Path Interaction Log

### Configuration

```bash
export SERVER_URL=http://localhost:8182
```

> **Note:** In the bash snippets below, `jq` is used to extract values from the JSON response.
> It is assumed that the response body of the previous `curl` command is captured in a variable named `$RESPONSE`.

## Step 0: Discovery

### Request

```bash
export RESPONSE=$(curl -s -X GET $SERVER_URL/.well-known/ucp)
```

### Response

```json
{
  "ucp": {
    "version": "2026-01-11",
    "services": {
      "dev.ucp.shopping": {
        "version": "2026-01-11",
        "spec": "https://ucp.dev/specification/reference",
        "rest": {
          "schema": "https://ucp.dev/services/shopping/openapi.json",
          "endpoint": "http://localhost:8182/"
        }
      }
    },
    "capabilities": [
      {
        "name": "dev.ucp.shopping.checkout",
        "version": "2026-01-11",
        "spec": "https://ucp.dev/specification/checkout",
        "schema": "https://ucp.dev/schemas/shopping/checkout.json"
      },
      {
        "name": "dev.ucp.shopping.order",
        "version": "2026-01-11",
        "spec": "https://ucp.dev/specification/order",
        "schema": "https://ucp.dev/schemas/shopping/order.json"
      },
      {
        "name": "dev.ucp.shopping.discount",
        "version": "2026-01-11",
        "spec": "https://ucp.dev/specification/discount",
        "schema": "https://ucp.dev/schemas/shopping/discount.json",
        "extends": "dev.ucp.shopping.checkout"
      },
      {
        "name": "dev.ucp.shopping.fulfillment",
        "version": "2026-01-11",
        "spec": "https://ucp.dev/specification/fulfillment",
        "schema": "https://ucp.dev/schemas/shopping/fulfillment.json",
        "extends": "dev.ucp.shopping.checkout"
      },
      {
        "name": "dev.ucp.shopping.buyer_consent",
        "version": "2026-01-11",
        "spec": "https://ucp.dev/specification/buyer_consent",
        "schema": "https://ucp.dev/schemas/shopping/buyer_consent.json",
        "extends": "dev.ucp.shopping.checkout"
      }
    ]
  },
  "payment": {
    "handlers": [
      {
        "id": "shop_pay",
        "name": "com.shopify.shop_pay",
        "version": "2026-01-11",
        "spec": "https://shopify.dev/ucp/handlers/shop_pay",
        "config_schema": "https://shopify.dev/ucp/handlers/shop_pay/config.json",
        "instrument_schemas": [
          "https://shopify.dev/ucp/handlers/shop_pay/instrument.json"
        ],
        "config": {
          "shop_id": "379b3f9d-0ec0-4293-a3c8-fb208d57b409"
        }
      },
      {
        "id": "google_pay",
        "name": "google.pay",
        "version": "2026-01-11",
        "spec": "https://developers.google.com/merchant/ucp/guides/gpay-payment-handler",
        "config_schema": "https://pay.google.com/gp/p/ucp/2026-01-11/schemas/gpay_config.json",
        "instrument_schemas": [
          "https://pay.google.com/gp/p/ucp/2026-01-11/schemas/gpay_card_payment_instrument.json"
        ],
        "config": {
          "api_version": 2,
          "api_version_minor": 0,
          "merchant_info": {
            "merchant_name": "Flower Shop",
            "merchant_id": "TEST",
            "merchant_origin": "localhost"
          },
          "allowed_payment_methods": [
            {
              "type": "CARD",
              "parameters": {
                "allowedAuthMethods": [
                  "PAN_ONLY",
                  "CRYPTOGRAM_3DS"
                ],
                "allowedCardNetworks": [
                  "VISA",
                  "MASTERCARD"
                ]
              },
              "tokenization_specification": [
                {
                  "type": "PAYMENT_GATEWAY",
                  "parameters": [
                    {
                      "gateway": "example",
                      "gatewayMerchantId": "exampleGatewayMerchantId"
                    }
                  ]
                }
              ]
            }
          ]
        }
      },
      {
        "id": "mock_payment_handler",
        "name": "dev.ucp.mock_payment",
        "version": "2026-01-11",
        "spec": "https://ucp.dev/specs/mock",
        "config_schema": "https://ucp.dev/schemas/mock.json",
        "instrument_schemas": [
          "https://ucp.dev/schemas/shopping/types/card_payment_instrument.json"
        ],
        "config": {
          "supported_tokens": [
            "success_token",
            "fail_token"
          ]
        }
      }
    ]
  }
}
```

## Step 1: Create Checkout Session

### Request

```bash
export RESPONSE=$(curl -s -X POST $SERVER_URL/checkout-sessions \
  -H 'UCP-Agent: profile="https://agent.example/profile"' \
  -H 'request-signature: test' \
  -H 'idempotency-key: 5016a7f8-2629-44e9-8f19-5ec2f922dd95' \
  -H 'request-id: 2fd57cd1-4679-434e-bb5e-ea8b48abbc4e' \
  -H 'Content-Type: application/json' \
  -d '{
  "line_items": [
    {
      "item": {
        "id": "bouquet_roses",
        "title": "Red Rose"
      },
      "quantity": 1
    }
  ],
  "buyer": {
    "full_name": "John Doe",
    "email": "john.doe@example.com"
  },
  "currency": "USD",
  "payment": {
    "instruments": [],
    "handlers": [
      {
        "id": "shop_pay",
        "name": "com.shopify.shop_pay",
        "version": "2026-01-11",
        "spec": "https://shopify.dev/ucp/handlers/shop_pay",
        "config_schema": "https://shopify.dev/ucp/handlers/shop_pay/config.json",
        "instrument_schemas": [
          "https://shopify.dev/ucp/handlers/shop_pay/instrument.json"
        ],
        "config": {
          "shop_id": "379b3f9d-0ec0-4293-a3c8-fb208d57b409"
        }
      },
      {
        "id": "google_pay",
        "name": "google.pay",
        "version": "2026-01-11",
        "spec": "https://developers.google.com/merchant/ucp/guides/gpay-payment-handler",
        "config_schema": "https://pay.google.com/gp/p/ucp/2026-01-11/schemas/gpay_config.json",
        "instrument_schemas": [
          "https://pay.google.com/gp/p/ucp/2026-01-11/schemas/gpay_card_payment_instrument.json"
        ],
        "config": {
          "api_version": 2,
          "api_version_minor": 0,
          "merchant_info": {
            "merchant_name": "Flower Shop",
            "merchant_id": "TEST",
            "merchant_origin": "localhost"
          },
          "allowed_payment_methods": [
            {
              "type": "CARD",
              "parameters": {
                "allowedAuthMethods": [
                  "PAN_ONLY",
                  "CRYPTOGRAM_3DS"
                ],
                "allowedCardNetworks": [
                  "VISA",
                  "MASTERCARD"
                ]
              },
              "tokenization_specification": [
                {
                  "type": "PAYMENT_GATEWAY",
                  "parameters": [
                    {
                      "gateway": "example",
                      "gatewayMerchantId": "exampleGatewayMerchantId"
                    }
                  ]
                }
              ]
            }
          ]
        }
      },
      {
        "id": "mock_payment_handler",
        "name": "dev.ucp.mock_payment",
        "version": "2026-01-11",
        "spec": "https://ucp.dev/specs/mock",
        "config_schema": "https://ucp.dev/schemas/mock.json",
        "instrument_schemas": [
          "https://ucp.dev/schemas/shopping/types/card_payment_instrument.json"
        ],
        "config": {
          "supported_tokens": [
            "success_token",
            "fail_token"
          ]
        }
      }
    ]
  }
}')
```

### Response

```json
{
  "ucp": {
    "version": "2026-01-11",
    "capabilities": [
      {
        "name": "dev.ucp.shopping.checkout",
        "version": "2026-01-11"
      }
    ]
  },
  "id": "cfea4fff-ea1a-4d2c-9dc4-0af18f6232ee",
  "line_items": [
    {
      "id": "21c10c57-e423-4a67-8dec-5757c2c0b69a",
      "item": {
        "id": "bouquet_roses",
        "title": "Bouquet of Red Roses",
        "price": 3500
      },
      "quantity": 1,
      "totals": [
        {
          "type": "subtotal",
          "amount": 3500
        },
        {
          "type": "total",
          "amount": 3500
        }
      ]
    }
  ],
  "buyer": {
    "full_name": "John Doe",
    "email": "john.doe@example.com"
  },
  "status": "ready_for_complete",
  "currency": "USD",
  "totals": [
    {
      "type": "subtotal",
      "amount": 3500
    },
    {
      "type": "total",
      "amount": 3500
    }
  ],
  "links": [],
  "payment": {
    "handlers": [],
    "instruments": []
  },
  "discounts": {}
}
```

### Extract Variables

```bash
export CHECKOUT_ID=$(echo $RESPONSE | jq -r '.id')
export LINE_ITEM_1_ID=$(echo $RESPONSE | jq -r '.line_items[0].id')
```

## Step 2: Add Items (Update Checkout)

### Request

```bash
export RESPONSE=$(curl -s -X PUT $SERVER_URL/checkout-sessions/$CHECKOUT_ID \
  -H 'UCP-Agent: profile="https://agent.example/profile"' \
  -H 'request-signature: test' \
  -H 'idempotency-key: 70d91834-1c02-4894-86b2-4ba4a33d2463' \
  -H 'request-id: 69983068-e6f2-463c-95e6-51e474c074b3' \
  -H 'Content-Type: application/json' \
  -d '{
  "id": "$CHECKOUT_ID",
  "line_items": [
    {
      "id": "$LINE_ITEM_1_ID",
      "item": {
        "id": "bouquet_roses",
        "title": "Red Rose"
      },
      "quantity": 1
    },
    {
      "item": {
        "id": "pot_ceramic",
        "title": "Ceramic Pot"
      },
      "quantity": 2
    }
  ],
  "currency": "USD",
  "payment": {
    "instruments": [],
    "handlers": []
  }
}')
```

### Response

```json
{
  "ucp": {
    "version": "2026-01-11",
    "capabilities": [
      {
        "name": "dev.ucp.shopping.checkout",
        "version": "2026-01-11"
      }
    ]
  },
  "id": "cfea4fff-ea1a-4d2c-9dc4-0af18f6232ee",
  "line_items": [
    {
      "id": "21c10c57-e423-4a67-8dec-5757c2c0b69a",
      "item": {
        "id": "bouquet_roses",
        "title": "Bouquet of Red Roses",
        "price": 3500
      },
      "quantity": 1,
      "totals": [
        {
          "type": "subtotal",
          "amount": 3500
        },
        {
          "type": "total",
          "amount": 3500
        }
      ]
    },
    {
      "id": "20ce6902-98e3-4d99-ac8e-f53952fbb2ce",
      "item": {
        "id": "pot_ceramic",
        "title": "Ceramic Pot",
        "price": 1500
      },
      "quantity": 2,
      "totals": [
        {
          "type": "subtotal",
          "amount": 3000
        },
        {
          "type": "total",
          "amount": 3000
        }
      ]
    }
  ],
  "buyer": {
    "full_name": "John Doe",
    "email": "john.doe@example.com"
  },
  "status": "ready_for_complete",
  "currency": "USD",
  "totals": [
    {
      "type": "subtotal",
      "amount": 6500
    },
    {
      "type": "total",
      "amount": 6500
    }
  ],
  "links": [],
  "payment": {
    "handlers": [],
    "instruments": []
  },
  "discounts": {}
}
```

### Extract Variables

```bash
export LINE_ITEM_2_ID=$(echo $RESPONSE | jq -r '.line_items[1].id')
```

## Step 3: Apply Discount

### Request

```bash
export RESPONSE=$(curl -s -X PUT $SERVER_URL/checkout-sessions/$CHECKOUT_ID \
  -H 'UCP-Agent: profile="https://agent.example/profile"' \
  -H 'request-signature: test' \
  -H 'idempotency-key: ea76d035-5d69-42a2-85b1-9881e501a0a3' \
  -H 'request-id: 27334aac-ae90-427f-9d91-832a69a36b1c' \
  -H 'Content-Type: application/json' \
  -d '{
  "id": "$CHECKOUT_ID",
  "line_items": [
    {
      "id": "$LINE_ITEM_1_ID",
      "item": {
        "id": "bouquet_roses",
        "title": "Red Rose"
      },
      "quantity": 1
    },
    {
      "id": "$LINE_ITEM_2_ID",
      "item": {
        "id": "pot_ceramic",
        "title": "Ceramic Pot"
      },
      "quantity": 2
    }
  ],
  "currency": "USD",
  "payment": {
    "instruments": [],
    "handlers": []
  },
  "discounts": {
    "codes": [
      "10OFF"
    ]
  }
}')
```

### Response

```json
{
  "ucp": {
    "version": "2026-01-11",
    "capabilities": [
      {
        "name": "dev.ucp.shopping.checkout",
        "version": "2026-01-11"
      }
    ]
  },
  "id": "cfea4fff-ea1a-4d2c-9dc4-0af18f6232ee",
  "line_items": [
    {
      "id": "21c10c57-e423-4a67-8dec-5757c2c0b69a",
      "item": {
        "id": "bouquet_roses",
        "title": "Bouquet of Red Roses",
        "price": 3500
      },
      "quantity": 1,
      "totals": [
        {
          "type": "subtotal",
          "amount": 3500
        },
        {
          "type": "total",
          "amount": 3500
        }
      ]
    },
    {
      "id": "20ce6902-98e3-4d99-ac8e-f53952fbb2ce",
      "item": {
        "id": "pot_ceramic",
        "title": "Ceramic Pot",
        "price": 1500
      },
      "quantity": 2,
      "totals": [
        {
          "type": "subtotal",
          "amount": 3000
        },
        {
          "type": "total",
          "amount": 3000
        }
      ]
    }
  ],
  "buyer": {
    "full_name": "John Doe",
    "email": "john.doe@example.com"
  },
  "status": "ready_for_complete",
  "currency": "USD",
  "totals": [
    {
      "type": "subtotal",
      "amount": 6500
    },
    {
      "type": "discount",
      "amount": 650
    },
    {
      "type": "total",
      "amount": 5850
    }
  ],
  "links": [],
  "payment": {
    "handlers": [],
    "instruments": []
  },
  "discounts": {
    "codes": [
      "10OFF"
    ],
    "applied": [
      {
        "code": "10OFF",
        "title": "10% Off",
        "amount": 650,
        "automatic": false,
        "allocations": [
          {
            "path": "$.totals[?(@.type=='subtotal')]",
            "amount": 650
          }
        ]
      }
    ]
  }
}
```

## Step 4: Trigger Fulfillment

### Request

```bash
export RESPONSE=$(curl -s -X PUT $SERVER_URL/checkout-sessions/$CHECKOUT_ID \
  -H 'UCP-Agent: profile="https://agent.example/profile"' \
  -H 'request-signature: test' \
  -H 'idempotency-key: 97f5d60a-b1d9-4f0c-925c-2aabc2309d88' \
  -H 'request-id: 0ed516b3-ac09-4ed8-bf47-fa62355e17fb' \
  -H 'Content-Type: application/json' \
  -d '{
  "id": "$CHECKOUT_ID",
  "line_items": [
    {
      "id": "$LINE_ITEM_1_ID",
      "item": {
        "id": "bouquet_roses",
        "title": "Red Rose"
      },
      "quantity": 1
    },
    {
      "id": "$LINE_ITEM_2_ID",
      "item": {
        "id": "pot_ceramic",
        "title": "Ceramic Pot"
      },
      "quantity": 2
    }
  ],
  "currency": "USD",
  "payment": {
    "instruments": [],
    "handlers": []
  },
  "fulfillment": {
    "methods": [
      {
        "type": "shipping"
      }
    ]
  }
}')
```

### Response

```json
{
  "ucp": {
    "version": "2026-01-11",
    "capabilities": [
      {
        "name": "dev.ucp.shopping.checkout",
        "version": "2026-01-11"
      }
    ]
  },
  "id": "cfea4fff-ea1a-4d2c-9dc4-0af18f6232ee",
  "line_items": [
    {
      "id": "21c10c57-e423-4a67-8dec-5757c2c0b69a",
      "item": {
        "id": "bouquet_roses",
        "title": "Bouquet of Red Roses",
        "price": 3500
      },
      "quantity": 1,
      "totals": [
        {
          "type": "subtotal",
          "amount": 3500
        },
        {
          "type": "total",
          "amount": 3500
        }
      ]
    },
    {
      "id": "20ce6902-98e3-4d99-ac8e-f53952fbb2ce",
      "item": {
        "id": "pot_ceramic",
        "title": "Ceramic Pot",
        "price": 1500
      },
      "quantity": 2,
      "totals": [
        {
          "type": "subtotal",
          "amount": 3000
        },
        {
          "type": "total",
          "amount": 3000
        }
      ]
    }
  ],
  "buyer": {
    "full_name": "John Doe",
    "email": "john.doe@example.com"
  },
  "status": "ready_for_complete",
  "currency": "USD",
  "totals": [
    {
      "type": "subtotal",
      "amount": 6500
    },
    {
      "type": "discount",
      "amount": 650
    },
    {
      "type": "total",
      "amount": 5850
    }
  ],
  "links": [],
  "payment": {
    "handlers": [],
    "instruments": []
  },
  "discounts": {
    "codes": [
      "10OFF"
    ],
    "applied": [
      {
        "code": "10OFF",
        "title": "10% Off",
        "amount": 650,
        "automatic": false,
        "allocations": [
          {
            "path": "$.totals[?(@.type=='subtotal')]",
            "amount": 650
          }
        ]
      },
      {
        "code": "10OFF",
        "title": "10% Off",
        "amount": 650,
        "automatic": false,
        "allocations": [
          {
            "path": "$.totals[?(@.type=='subtotal')]",
            "amount": 650
          }
        ]
      }
    ]
  },
  "fulfillment": {
    "methods": [
      {
        "id": "00b9354d-1508-45cf-8934-2bdd7daaec05",
        "type": "shipping",
        "line_item_ids": [
          "21c10c57-e423-4a67-8dec-5757c2c0b69a",
          "20ce6902-98e3-4d99-ac8e-f53952fbb2ce"
        ],
        "destinations": [
          {
            "street_address": "123 Main St",
            "address_country": "US",
            "postal_code": "62704",
            "id": "addr_1",
            "city": "Springfield",
            "region": "IL"
          },
          {
            "street_address": "456 Oak Ave",
            "address_country": "US",
            "postal_code": "10012",
            "id": "addr_2",
            "city": "Metropolis",
            "region": "NY"
          },
          {
            "street_address": "123 New St",
            "address_country": "CA",
            "postal_code": "M5V 2H1",
            "id": "dest_new"
          },
          {
            "street_address": "Webhook St",
            "address_country": "CA",
            "postal_code": "M5V 2H1",
            "id": "dest_new_webhook"
          }
        ]
      }
    ]
  }
}
```

### Extract Variables

```bash
export FULFILLMENT_METHOD_ID=$(echo $RESPONSE | jq -r '.fulfillment.methods[0].id')
export DESTINATION_ID=$(echo $RESPONSE | jq -r '.fulfillment.methods[0].destinations[0].id')
```

## Step 5: Select Destination

### Request

```bash
export RESPONSE=$(curl -s -X PUT $SERVER_URL/checkout-sessions/$CHECKOUT_ID \
  -H 'UCP-Agent: profile="https://agent.example/profile"' \
  -H 'request-signature: test' \
  -H 'idempotency-key: 187b75b5-0c82-4cd8-b9c3-79254cc89771' \
  -H 'request-id: 2933674e-082f-492c-9cd0-b46faae6794a' \
  -H 'Content-Type: application/json' \
  -d '{
  "id": "$CHECKOUT_ID",
  "line_items": [
    {
      "id": "$LINE_ITEM_1_ID",
      "item": {
        "id": "bouquet_roses",
        "title": "Red Rose"
      },
      "quantity": 1
    },
    {
      "id": "$LINE_ITEM_2_ID",
      "item": {
        "id": "pot_ceramic",
        "title": "Ceramic Pot"
      },
      "quantity": 2
    }
  ],
  "currency": "USD",
  "payment": {
    "instruments": [],
    "handlers": []
  },
  "fulfillment": {
    "methods": [
      {
        "type": "shipping",
        "selected_destination_id": "$DESTINATION_ID"
      }
    ]
  }
}')
```

### Response

```json
{
  "ucp": {
    "version": "2026-01-11",
    "capabilities": [
      {
        "name": "dev.ucp.shopping.checkout",
        "version": "2026-01-11"
      }
    ]
  },
  "id": "cfea4fff-ea1a-4d2c-9dc4-0af18f6232ee",
  "line_items": [
    {
      "id": "21c10c57-e423-4a67-8dec-5757c2c0b69a",
      "item": {
        "id": "bouquet_roses",
        "title": "Bouquet of Red Roses",
        "price": 3500
      },
      "quantity": 1,
      "totals": [
        {
          "type": "subtotal",
          "amount": 3500
        },
        {
          "type": "total",
          "amount": 3500
        }
      ]
    },
    {
      "id": "20ce6902-98e3-4d99-ac8e-f53952fbb2ce",
      "item": {
        "id": "pot_ceramic",
        "title": "Ceramic Pot",
        "price": 1500
      },
      "quantity": 2,
      "totals": [
        {
          "type": "subtotal",
          "amount": 3000
        },
        {
          "type": "total",
          "amount": 3000
        }
      ]
    }
  ],
  "buyer": {
    "full_name": "John Doe",
    "email": "john.doe@example.com"
  },
  "status": "ready_for_complete",
  "currency": "USD",
  "totals": [
    {
      "type": "subtotal",
      "amount": 6500
    },
    {
      "type": "discount",
      "amount": 650
    },
    {
      "type": "total",
      "amount": 5850
    }
  ],
  "links": [],
  "payment": {
    "handlers": [],
    "instruments": []
  },
  "discounts": {
    "codes": [
      "10OFF"
    ],
    "applied": [
      {
        "code": "10OFF",
        "title": "10% Off",
        "amount": 650,
        "automatic": false,
        "allocations": [
          {
            "path": "$.totals[?(@.type=='subtotal')]",
            "amount": 650
          }
        ]
      },
      {
        "code": "10OFF",
        "title": "10% Off",
        "amount": 650,
        "automatic": false,
        "allocations": [
          {
            "path": "$.totals[?(@.type=='subtotal')]",
            "amount": 650
          }
        ]
      },
      {
        "code": "10OFF",
        "title": "10% Off",
        "amount": 650,
        "automatic": false,
        "allocations": [
          {
            "path": "$.totals[?(@.type=='subtotal')]",
            "amount": 650
          }
        ]
      }
    ]
  },
  "fulfillment": {
    "methods": [
      {
        "id": "00b9354d-1508-45cf-8934-2bdd7daaec05",
        "type": "shipping",
        "line_item_ids": [
          "21c10c57-e423-4a67-8dec-5757c2c0b69a",
          "20ce6902-98e3-4d99-ac8e-f53952fbb2ce"
        ],
        "destinations": [
          {
            "street_address": "123 Main St",
            "address_country": "US",
            "postal_code": "62704",
            "id": "addr_1",
            "city": "Springfield",
            "region": "IL"
          },
          {
            "street_address": "456 Oak Ave",
            "address_country": "US",
            "postal_code": "10012",
            "id": "addr_2",
            "city": "Metropolis",
            "region": "NY"
          },
          {
            "street_address": "123 New St",
            "address_country": "CA",
            "postal_code": "M5V 2H1",
            "id": "dest_new"
          },
          {
            "street_address": "Webhook St",
            "address_country": "CA",
            "postal_code": "M5V 2H1",
            "id": "dest_new_webhook"
          }
        ],
        "selected_destination_id": "addr_1",
        "groups": [
          {
            "id": "group_5a1cd28c-0d0e-46d9-88a8-8840b36dd0d9",
            "line_item_ids": [
              "21c10c57-e423-4a67-8dec-5757c2c0b69a",
              "20ce6902-98e3-4d99-ac8e-f53952fbb2ce"
            ],
            "options": [
              {
                "id": "std-ship",
                "title": "Standard Shipping (Free)",
                "totals": [
                  {
                    "type": "subtotal",
                    "amount": 0
                  },
                  {
                    "type": "total",
                    "amount": 0
                  }
                ]
              },
              {
                "id": "exp-ship-us",
                "title": "Express Shipping (US)",
                "totals": [
                  {
                    "type": "subtotal",
                    "amount": 1500
                  },
                  {
                    "type": "total",
                    "amount": 1500
                  }
                ]
              }
            ]
          }
        ]
      }
    ]
  }
}
```

## Step 6: Select Option

### Request

```bash
export RESPONSE=$(curl -s -X PUT $SERVER_URL/checkout-sessions/$CHECKOUT_ID \
  -H 'UCP-Agent: profile="https://agent.example/profile"' \
  -H 'request-signature: test' \
  -H 'idempotency-key: ce25cbf1-eb68-43ee-9615-97c0ddf106de' \
  -H 'request-id: c55bd610-20b0-444c-858c-e2a9fd49cad4' \
  -H 'Content-Type: application/json' \
  -d '{
  "id": "$CHECKOUT_ID",
  "line_items": [
    {
      "id": "$LINE_ITEM_1_ID",
      "item": {
        "id": "bouquet_roses",
        "title": "Red Rose"
      },
      "quantity": 1
    },
    {
      "id": "$LINE_ITEM_2_ID",
      "item": {
        "id": "pot_ceramic",
        "title": "Ceramic Pot"
      },
      "quantity": 2
    }
  ],
  "currency": "USD",
  "payment": {
    "instruments": [],
    "handlers": []
  },
  "fulfillment": {
    "methods": [
      {
        "type": "shipping",
        "selected_destination_id": "$DESTINATION_ID",
        "groups": [
          {
            "selected_option_id": "std-ship"
          }
        ]
      }
    ]
  }
}')
```

### Response

```json
{
  "ucp": {
    "version": "2026-01-11",
    "capabilities": [
      {
        "name": "dev.ucp.shopping.checkout",
        "version": "2026-01-11"
      }
    ]
  },
  "id": "cfea4fff-ea1a-4d2c-9dc4-0af18f6232ee",
  "line_items": [
    {
      "id": "21c10c57-e423-4a67-8dec-5757c2c0b69a",
      "item": {
        "id": "bouquet_roses",
        "title": "Bouquet of Red Roses",
        "price": 3500
      },
      "quantity": 1,
      "totals": [
        {
          "type": "subtotal",
          "amount": 3500
        },
        {
          "type": "total",
          "amount": 3500
        }
      ]
    },
    {
      "id": "20ce6902-98e3-4d99-ac8e-f53952fbb2ce",
      "item": {
        "id": "pot_ceramic",
        "title": "Ceramic Pot",
        "price": 1500
      },
      "quantity": 2,
      "totals": [
        {
          "type": "subtotal",
          "amount": 3000
        },
        {
          "type": "total",
          "amount": 3000
        }
      ]
    }
  ],
  "buyer": {
    "full_name": "John Doe",
    "email": "john.doe@example.com"
  },
  "status": "ready_for_complete",
  "currency": "USD",
  "totals": [
    {
      "type": "subtotal",
      "amount": 6500
    },
    {
      "type": "fulfillment",
      "amount": 0
    },
    {
      "type": "discount",
      "amount": 650
    },
    {
      "type": "total",
      "amount": 5850
    }
  ],
  "links": [],
  "payment": {
    "handlers": [],
    "instruments": []
  },
  "discounts": {
    "codes": [
      "10OFF"
    ],
    "applied": [
      {
        "code": "10OFF",
        "title": "10% Off",
        "amount": 650,
        "automatic": false,
        "allocations": [
          {
            "path": "$.totals[?(@.type=='subtotal')]",
            "amount": 650
          }
        ]
      },
      {
        "code": "10OFF",
        "title": "10% Off",
        "amount": 650,
        "automatic": false,
        "allocations": [
          {
            "path": "$.totals[?(@.type=='subtotal')]",
            "amount": 650
          }
        ]
      },
      {
        "code": "10OFF",
        "title": "10% Off",
        "amount": 650,
        "automatic": false,
        "allocations": [
          {
            "path": "$.totals[?(@.type=='subtotal')]",
            "amount": 650
          }
        ]
      },
      {
        "code": "10OFF",
        "title": "10% Off",
        "amount": 650,
        "automatic": false,
        "allocations": [
          {
            "path": "$.totals[?(@.type=='subtotal')]",
            "amount": 650
          }
        ]
      }
    ]
  },
  "fulfillment": {
    "methods": [
      {
        "id": "00b9354d-1508-45cf-8934-2bdd7daaec05",
        "type": "shipping",
        "line_item_ids": [
          "21c10c57-e423-4a67-8dec-5757c2c0b69a",
          "20ce6902-98e3-4d99-ac8e-f53952fbb2ce"
        ],
        "destinations": [
          {
            "street_address": "123 Main St",
            "address_country": "US",
            "postal_code": "62704",
            "id": "addr_1",
            "city": "Springfield",
            "region": "IL"
          },
          {
            "street_address": "456 Oak Ave",
            "address_country": "US",
            "postal_code": "10012",
            "id": "addr_2",
            "city": "Metropolis",
            "region": "NY"
          },
          {
            "street_address": "123 New St",
            "address_country": "CA",
            "postal_code": "M5V 2H1",
            "id": "dest_new"
          },
          {
            "street_address": "Webhook St",
            "address_country": "CA",
            "postal_code": "M5V 2H1",
            "id": "dest_new_webhook"
          }
        ],
        "selected_destination_id": "addr_1",
        "groups": [
          {
            "id": "group_113a1801-bf75-4cc4-b6be-f67377b61dae",
            "line_item_ids": [
              "21c10c57-e423-4a67-8dec-5757c2c0b69a",
              "20ce6902-98e3-4d99-ac8e-f53952fbb2ce"
            ],
            "options": [
              {
                "id": "std-ship",
                "title": "Standard Shipping (Free)",
                "totals": [
                  {
                    "type": "subtotal",
                    "amount": 0
                  },
                  {
                    "type": "total",
                    "amount": 0
                  }
                ]
              },
              {
                "id": "exp-ship-us",
                "title": "Express Shipping (US)",
                "totals": [
                  {
                    "type": "subtotal",
                    "amount": 1500
                  },
                  {
                    "type": "total",
                    "amount": 1500
                  }
                ]
              }
            ],
            "selected_option_id": "std-ship"
          }
        ]
      }
    ]
  }
}
```

## Step 7: Complete Checkout

### Request

```bash
export RESPONSE=$(curl -s -X POST $SERVER_URL/checkout-sessions/$CHECKOUT_ID/complete \
  -H 'UCP-Agent: profile="https://agent.example/profile"' \
  -H 'request-signature: test' \
  -H 'idempotency-key: 8c7142bd-7ebc-4e2a-9cd9-6fdc2f0dab19' \
  -H 'request-id: dc78aac0-b6bf-4df5-ac7d-a7da46a710cd' \
  -H 'Content-Type: application/json' \
  -d '{
  "payment_data": {
    "id": "instr_my_card",
    "handler_id": "mock_payment_handler",
    "type": "card",
    "billing_address": {
      "street_address": "123 Main St",
      "address_locality": "Anytown",
      "address_region": "CA",
      "address_country": "US",
      "postal_code": "12345"
    },
    "credential": {
      "type": "token",
      "token": "success_token"
    },
    "brand": "Visa",
    "last_digits": "4242",
    "handler_name": "mock_payment_handler"
  },
  "risk_signals": {
    "ip": "127.0.0.1",
    "browser": "python-httpx"
  }
}')
```

### Response

```json
{
  "ucp": {
    "version": "2026-01-11",
    "capabilities": [
      {
        "name": "dev.ucp.shopping.checkout",
        "version": "2026-01-11"
      }
    ]
  },
  "id": "cfea4fff-ea1a-4d2c-9dc4-0af18f6232ee",
  "line_items": [
    {
      "id": "21c10c57-e423-4a67-8dec-5757c2c0b69a",
      "item": {
        "id": "bouquet_roses",
        "title": "Bouquet of Red Roses",
        "price": 3500
      },
      "quantity": 1,
      "totals": [
        {
          "type": "subtotal",
          "amount": 3500
        },
        {
          "type": "total",
          "amount": 3500
        }
      ]
    },
    {
      "id": "20ce6902-98e3-4d99-ac8e-f53952fbb2ce",
      "item": {
        "id": "pot_ceramic",
        "title": "Ceramic Pot",
        "price": 1500
      },
      "quantity": 2,
      "totals": [
        {
          "type": "subtotal",
          "amount": 3000
        },
        {
          "type": "total",
          "amount": 3000
        }
      ]
    }
  ],
  "buyer": {
    "full_name": "John Doe",
    "email": "john.doe@example.com"
  },
  "status": "completed",
  "currency": "USD",
  "totals": [
    {
      "type": "subtotal",
      "amount": 6500
    },
    {
      "type": "fulfillment",
      "amount": 0
    },
    {
      "type": "discount",
      "amount": 650
    },
    {
      "type": "total",
      "amount": 5850
    }
  ],
  "links": [],
  "payment": {
    "handlers": [],
    "instruments": []
  },
  "order": {
    "id": "4c50e638-5c35-4857-8882-d30ea5eab8e4",
    "permalink_url": "http://localhost:8182/orders/4c50e638-5c35-4857-8882-d30ea5eab8e4"
  },
  "discounts": {
    "codes": [
      "10OFF"
    ],
    "applied": [
      {
        "code": "10OFF",
        "title": "10% Off",
        "amount": 650,
        "automatic": false,
        "allocations": [
          {
            "path": "$.totals[?(@.type=='subtotal')]",
            "amount": 650
          }
        ]
      },
      {
        "code": "10OFF",
        "title": "10% Off",
        "amount": 650,
        "automatic": false,
        "allocations": [
          {
            "path": "$.totals[?(@.type=='subtotal')]",
            "amount": 650
          }
        ]
      },
      {
        "code": "10OFF",
        "title": "10% Off",
        "amount": 650,
        "automatic": false,
        "allocations": [
          {
            "path": "$.totals[?(@.type=='subtotal')]",
            "amount": 650
          }
        ]
      },
      {
        "code": "10OFF",
        "title": "10% Off",
        "amount": 650,
        "automatic": false,
        "allocations": [
          {
            "path": "$.totals[?(@.type=='subtotal')]",
            "amount": 650
          }
        ]
      }
    ]
  },
  "fulfillment": {
    "methods": [
      {
        "id": "00b9354d-1508-45cf-8934-2bdd7daaec05",
        "type": "shipping",
        "line_item_ids": [
          "21c10c57-e423-4a67-8dec-5757c2c0b69a",
          "20ce6902-98e3-4d99-ac8e-f53952fbb2ce"
        ],
        "destinations": [
          {
            "street_address": "123 Main St",
            "address_country": "US",
            "postal_code": "62704",
            "id": "addr_1",
            "city": "Springfield",
            "region": "IL"
          },
          {
            "street_address": "456 Oak Ave",
            "address_country": "US",
            "postal_code": "10012",
            "id": "addr_2",
            "city": "Metropolis",
            "region": "NY"
          },
          {
            "street_address": "123 New St",
            "address_country": "CA",
            "postal_code": "M5V 2H1",
            "id": "dest_new"
          },
          {
            "street_address": "Webhook St",
            "address_country": "CA",
            "postal_code": "M5V 2H1",
            "id": "dest_new_webhook"
          }
        ],
        "selected_destination_id": "addr_1",
        "groups": [
          {
            "id": "group_113a1801-bf75-4cc4-b6be-f67377b61dae",
            "line_item_ids": [
              "21c10c57-e423-4a67-8dec-5757c2c0b69a",
              "20ce6902-98e3-4d99-ac8e-f53952fbb2ce"
            ],
            "options": [
              {
                "id": "std-ship",
                "title": "Standard Shipping (Free)",
                "totals": [
                  {
                    "type": "subtotal",
                    "amount": 0
                  },
                  {
                    "type": "total",
                    "amount": 0
                  }
                ]
              },
              {
                "id": "exp-ship-us",
                "title": "Express Shipping (US)",
                "totals": [
                  {
                    "type": "subtotal",
                    "amount": 1500
                  },
                  {
                    "type": "total",
                    "amount": 1500
                  }
                ]
              }
            ],
            "selected_option_id": "std-ship"
          }
        ]
      }
    ]
  }
}
```

### Extract Variables

```bash
export ORDER_ID=$(echo $RESPONSE | jq -r '.order.id')
```

